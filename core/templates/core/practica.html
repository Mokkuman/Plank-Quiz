{% extends 'core/layout.html' %}

{% load static %}

{%block cssPath%}
    <link rel="stylesheet" href="{% static 'core/styleContent.css' %}"  type="text/css"/>
{%endblock cssPath%}

{% block title %}
    {{practica.titulo}}
{% endblock title %}

{% block body %}

    <div class="document-container">
        <div class="container-center">
            <div class="center-xy">
                <p class="title">Práctica: {{ practica.titulo }}</p>
            </div>
        </div>
        

        <h3>Tema: {{ practica.filtro }}</h3>
        <h3>Voto: {{ practica.voto }}</h3>
        
        <h5>Descripción: {{ practica.descripcion }}</h5>
        <h5>Responda las siguientes preguntas:</h5>

        <div class="practica-contenido">
            <div>
                {% for abierta in abiertas %}
                    <div class="practica-pregunta">
                        <div class="enunciado">
                            Pregunta: {{ abierta }}
                            <div class="form-box">
                                <input class="input-box" type="text" id="{{ abierta.id }}" name="pregA{{ abierta.id }}" placeholder="respuesta">
                            </div>
                        </div>
                    </div>
                {% endfor %}
            </div>
            <div>
                {% for cerrada in cerradas %}
                    <div class="practica-pregunta">
                        <div class="enunciado">
                            Pregunta: {{ cerrada }}
                        </div>
                        {% for respuesta in cerrada.get_respuestas %}
                            <div>
                                <div>
                                  <input type="radio" id="{{ respuesta.id }}" name="pregC{{respuesta.id}}" value="">
                                  <label for="pregunta">{{ respuesta.respuesta }}</label>
                                </div>
                            
                            </div>
                        {% endfor %}
                    </div>
                {% endfor %}
            </div>
        
        </div>

        <div class="like-dislike">
            <p class="votos" id="votos">{{practica.voto}}</p>
            <!--Verifica si previamente el usuario había votado positivo(1), negativo(0) o no ha votado (-1)-->
            <button class="voto" id="positivo" data-catid="{{practica.id}}" {% if voto == 1%} value="selected" {%else%} value="unselected" {%endif%}>Me gusta :D</button>
            <button class="voto" id="negativo" data-catid="{{practica.id}}" {% if voto == 0%} value="selected" {%else%} value="unselected" {%endif%}>No me gusta >:(</button>
        </div>

    </div>

    <script>
        $('#positivo').click(function(){
            var catid;
            catid = $(this).attr('data-catid');
            $.ajax({
                type: 'POST',
                url: '{% url "voto:votoPract" %}',
                data:{
                    id : catid,
                    tipo : 1,
                    csrfmiddlewaretoken:"{{csrf_token}}",
                    action: 'post',
                },
                success: function(json){
                    document.getElementById("votos").innerHTML = json.voto
                    if( document.getElementById('positivo').getAttribute('value') == 'selected'){   /*Si se selecciona Positivo y estaba "Selected", cambia a "Unselected"*/
                        document.getElementById('positivo').setAttribute('value','unselected');
                    }else{                                                                          /*Si se selecciona Positivo y estaba "Unselected" cambia a "Selected"*/
                        document.getElementById('positivo').setAttribute('value','selected');
                        if(document.getElementById('negativo').getAttribute('value') == 'selected'){/*Si estaba seleccionado Negativo, Negativo cambia a "Unselected"*/
                            document.getElementById('negativo').setAttribute('value','unselected');
                        }
                    }
                },
                error: function(xhr,errmsg,err){}
            })
        });
        $('#negativo').click(function(){
            var catid;
            catid = $(this).attr('data-catid');
            $.ajax({
                type: 'POST',
                url: '{% url "voto:votoPract" %}',
                data:{
                    id : catid,
                    tipo: -1,
                    csrfmiddlewaretoken:"{{csrf_token}}",
                    action: 'post',
                },
                success: function(json){
                    document.getElementById("votos").innerHTML = json.voto
                    if( document.getElementById('negativo').getAttribute('value') == 'selected'){/*Si se selecciona Negativo y estaba"Selected", cambia a "Unselected"*/
                        document.getElementById('negativo').setAttribute('value','unselected');
                    }else{                                                                      /*Si se selecciona Negativo y estaba "Unselected" cambia a "Selected"*/
                        document.getElementById('negativo').setAttribute('value','selected');
                        if(document.getElementById('positivo').getAttribute('value') == 'selected'){/*Si estaba seleccionado Negativo, Positivo cambia a "Unselected"*/
                            document.getElementById('positivo').setAttribute('value','unselected');
                        }
                    }
                },
                error: function(xhr,errmsg,err){}
            })
        });
        </script>

{% endblock body %} 